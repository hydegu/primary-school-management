# 小学教务管理系统 - API接口文档（整合版）

> **文档版本**: v2.0
> **最后更新**: 2025-11-18
> **项目状态**: 开发中 🚧

---

## 📌 文档说明

本文档整合了小学教务管理系统的所有API接口设计，并**准确标注**了当前的实现状态。

**图例说明**：
- ✅ **已实现** - 接口已完成开发并可正常使用
- ⚠️ **部分实现** - 接口已开发但功能不完整或存在问题
- 🚧 **未实现** - 接口设计已确定，但尚未开发

**当前实际实现进度**：
- **系统管理模块**：20% (2/10 接口已实现)
- **教务核心模块**：35% (14/40 接口已实现)
- **业务流程模块**：20% (5/25 接口已实现)
- **总体进度**：28% (21/75 接口已实现)

---

## 📋 目录

- [一、系统管理模块](#一系统管理模块)
  - [1.1 用户认证接口](#11-用户认证接口)
  - [1.2 角色管理接口](#12-角色管理接口)
  - [1.3 菜单管理接口](#13-菜单管理接口)
- [二、教务核心模块](#二教务核心模块)
  - [2.1 教师管理接口](#21-教师管理接口)
  - [2.2 学生管理接口](#22-学生管理接口)
  - [2.3 班级管理接口](#23-班级管理接口)
  - [2.4 年级管理接口](#24-年级管理接口)
  - [2.5 科目管理接口](#25-科目管理接口)
  - [2.6 课程管理接口](#26-课程管理接口)
  - [2.7 排课管理接口](#27-排课管理接口)
- [三、业务流程模块](#三业务流程模块)
  - [3.1 请假申请接口](#31-请假申请接口)
  - [3.2 调课申请接口](#32-调课申请接口)
  - [3.3 换课申请接口](#33-换课申请接口)
  - [3.4 调班申请接口](#34-调班申请接口)
  - [3.5 审批流程接口](#35-审批流程接口)

---

## 一、系统管理模块

### 1.1 用户认证接口

#### 1.1.1 用户登录 ✅

**接口地址**: `POST /api/user/login`

**实现状态**: ✅ 已实现

**功能描述**: 用户登录验证，成功后返回JWT Token

**请求参数**:
```json
{
  "identifier": "admin",      // 用户名或手机号或邮箱
  "password": "admin123"      // 密码
}
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."  // JWT Token
}
```

**实现位置**: `UserController.java:50`

---

#### 1.1.2 用户登出 ✅

**接口地址**: `POST /api/user/logout`

**实现状态**: ✅ 已实现

**功能描述**: 用户登出，将Token加入黑名单

**请求头**:
```
Authorization: Bearer <token>
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "登出成功"
}
```

**实现位置**: `UserController.java:80`

---

#### 1.1.5 获取当前用户信息 🚧

**接口地址**: `GET /api/user/profile`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 需要从Token中解析用户ID
- ⚠️ 需要关联查询角色和权限信息

---

### 1.2 角色管理接口

#### 1.2.1 ~ 1.2.5 角色相关接口 🚧

**实现状态**: 🚧 **完全未实现**

**未实现原因**:

- ⚠️ 未创建 `RoleController`
- ⚠️ 未创建 `RoleService` 接口
- ⚠️ 需要实现分页查询功能

**涉及接口**:
- `GET /api/role/list` - 角色列表查询
- `POST /api/role` - 添加角色
- `PUT /api/role/{id}` - 修改角色
- `DELETE /api/role/{id}` - 删除角色
- `POST /api/role/{id}/menu` - 分配权限

---

### 1.3 菜单管理接口

#### 1.3.1 ~ 1.3.4 菜单相关接口 🚧

**实现状态**: 🚧 **完全未实现**

**未实现原因**:
- ⚠️ 未创建 `MenuController`
- ⚠️ 需要实现递归树形结构
- ⚠️ 需要根据用户角色过滤菜单

**涉及接口**:
- `GET /api/menu/tree` - 菜单树查询
- `POST /api/menu` - 添加菜单
- `PUT /api/menu/{id}` - 修改菜单
- `DELETE /api/menu/{id}` - 删除菜单

---

## 二、教务核心模块

### 2.1 教师管理接口

#### 2.1.1 教师列表查询 ✅

**接口地址**: `GET /api/teacher/list`

**实现状态**: ✅ 已实现

**功能描述**: 查询教师列表，支持条件筛选（姓名、工号、职称）

**请求参数**:
```
teacherName=张&teacherNo=T001&title=语文教师
```

**实现位置**: `TeacherController.java:28`

**已实现功能**:
- ✅ 支持姓名模糊查询
- ✅ 支持工号查询
- ✅ 支持职称查询
- ⚠️ 未实现分页功能

---

#### 2.1.2 添加教师 ✅

**接口地址**: `POST /api/teacher`

**实现状态**: ✅ 已实现

**功能描述**: 添加新教师信息

**请求参数**:
```json
{
  "teacherNo": "T100",
  "teacherName": "李老师",
  "gender": 1,
  "birthDate": "1985-03-15",
  "idCard": "110101198503150011",
  "phone": "13900139000",
  "email": "teacher100@school.com",
  "title": "数学教师",
  "hireDate": "2024-09-01"
}
```

**实现位置**: `TeacherController.java:53`

**已实现功能**:
- ✅ 基本信息添加
- ⚠️ 未实现教师编号唯一性验证
- ⚠️ 未自动创建对应的 sys_user 账号
- ⚠️ 未自动分配教师角色

---

#### 2.1.3 修改教师 ✅

**接口地址**: `PUT /api/teacher/{id}`

**实现状态**: ✅ 已实现

**实现位置**: `TeacherController.java:61`

---

#### 2.1.4 删除教师 ✅

**接口地址**: `DELETE /api/teacher/{id}`

**实现状态**: ✅ 已实现

**实现位置**: `TeacherController.java:57`

**已实现功能**:
- ✅ 基本删除功能
- ⚠️ 未检查教师是否担任班主任
- ⚠️ 未检查教师是否有任课记录
- ⚠️ 未使用软删除

---

#### 2.1.5 教师详情 ⚠️

**接口地址**: `GET /api/teacher/{id}`

**实现状态**: ⚠️ 部分实现（**存在BUG**）

**实现位置**: `TeacherController.java:14`

**问题说明**:
- ❌ 接口定义了 `{id}` 路径参数，但方法参数是 `Teacher teacher`
- ❌ 方法体调用的是 `teacherList()`，而不是根据ID查询
- ❌ 需要修复此接口

**建议修复**:
```java
@GetMapping(value="/teacher/{id}")
public R getTeacherById(@PathVariable Integer id) {
    return this.teacherService.getTeacherById(id);
}
```

---

#### 2.1.6 教师课程表 🚧

**接口地址**: `GET /api/teacher/{id}/schedule`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 需要关联查询 `edu_schedule`、`edu_course`、`edu_subject` 表
- ⚠️ 需要先实现排课管理模块

---

### 2.2 学生管理接口

#### 2.2.1 学生列表查询 ✅

**接口地址**: `GET /api/student/list`

**实现状态**: ✅ 已实现

**功能描述**: 查询学生列表，支持条件筛选

**请求参数**: 支持Map参数（具体字段由Service层处理）

**实现位置**: `StudentController.java:35`

**已实现功能**:
- ✅ 基本列表查询
- ✅ 支持条件筛选
- ⚠️ 未明确支持的查询字段
- ⚠️ 未实现分页功能

---

#### 2.2.2 添加学生 ✅

**接口地址**: `POST /api/student`

**实现状态**: ✅ 已实现

**功能描述**: 添加新学生

**请求参数**:
```json
{
  "studentNo": "S2024001",
  "studentName": "小明",
  "gender": 1,
  "birthDate": "2016-05-20",
  "idCard": "110101201605200011",
  "gradeId": 1,
  "classId": 1,
  "parentPhone": "13800138000"
}
```

**实现位置**: `StudentController.java:22`

**已实现功能**:
- ✅ 基本信息添加
- ✅ 学号和姓名必填验证
- ⚠️ 未实现学号唯一性验证
- ⚠️ 未自动创建对应的 sys_user 账号
- ⚠️ 未更新班级学生人数
- ⚠️ 未关联家长信息

---

#### 2.2.3 修改学生 ✅

**接口地址**: `PUT /api/student/{id}`

**实现状态**: ✅ 已实现

**实现位置**: `StudentController.java:44`

---

#### 2.2.4 删除学生 ✅

**接口地址**: `DELETE /api/student/{id}`

**实现状态**: ✅ 已实现

**实现位置**: `StudentController.java:57`

**已实现功能**:
- ✅ 基本删除功能
- ⚠️ 未更新班级学生人数
- ⚠️ 未使用软删除

---

#### 2.2.5 学生详情 🚧

**接口地址**: `GET /api/student/{id}`

**实现状态**: 🚧 未实现

---

#### 2.2.6 学生家长关联 🚧

**接口地址**: `POST /api/student/{id}/parent`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 `Parent` 实体类
- ⚠️ 需要操作 `edu_student_parent` 关联表

---

### 2.3 班级管理接口

#### 2.3.1 班级列表查询 ✅

**接口地址**: `GET /api/class/list`

**实现状态**: ✅ 已实现

**实现位置**: `ClassesController.java:16`

**已实现功能**:
- ✅ 基本列表查询
- ⚠️ 未关联查询年级、班主任信息
- ⚠️ 未显示当前学生人数
- ⚠️ 未实现分页功能

---

#### 2.3.2 添加班级 ✅

**接口地址**: `POST /api/class`

**实现状态**: ✅ 已实现

**实现位置**: `ClassesController.java:20`

**已实现功能**:
- ✅ 基本信息添加
- ⚠️ 未实现班级编号唯一性验证
- ⚠️ 未验证班主任是否已担任其他班级班主任
- ⚠️ 未验证教室是否被占用

---

#### 2.3.3 修改班级 ✅

**接口地址**: `PUT /api/class/{id}`

**实现状态**: ✅ 已实现

**实现位置**: `ClassesController.java:28`

---

#### 2.3.4 删除班级 ✅

**接口地址**: `DELETE /api/class/{id}`

**实现状态**: ✅ 已实现

**实现位置**: `ClassesController.java:24`

**已实现功能**:
- ✅ 基本删除功能
- ⚠️ 未检查班级是否有学生
- ⚠️ 未使用软删除

---

#### 2.3.5 班级详情 🚧

**接口地址**: `GET /api/class/{id}`

**实现状态**: 🚧 未实现

---

#### 2.3.6 班级课程表 🚧

**接口地址**: `GET /api/class/{id}/schedule`

**实现状态**: 🚧 未实现

---

#### 2.3.7 班级学生列表 🚧

**接口地址**: `GET /api/class/{id}/students`

**实现状态**: 🚧 未实现

---

### 2.4 年级管理接口

#### 2.4.1 年级列表查询 ✅

**接口地址**: `GET /api/grade/**`

**实现状态**: ✅ 已实现（仅查询功能）

**实现位置**: `GradeController.java:18`

**已实现功能**:
- ✅ 基本列表查询
- ⚠️ 路径使用了 `**` 通配符，不规范
- ⚠️ 未实现分页功能

---

#### 2.4.2 ~ 2.4.4 年级增删改接口 🚧

**实现状态**: 🚧 未实现

**涉及接口**:
- `POST /api/grade` - 添加年级
- `PUT /api/grade/{id}` - 修改年级
- `DELETE /api/grade/{id}` - 删除年级

---

### 2.5 科目管理接口

#### 2.5.1 ~ 2.5.4 科目相关接口 🚧

**实现状态**: 🚧 **完全未实现**

**未实现原因**:
- ⚠️ 未创建 `Subject` 实体类
- ⚠️ 未创建 `SubjectController`
- ⚠️ 未创建 `SubjectService`

**涉及接口**:
- `GET /api/subject/list` - 科目列表
- `POST /api/subject` - 添加科目
- `PUT /api/subject/{id}` - 修改科目
- `DELETE /api/subject/{id}` - 删除科目

---

### 2.6 课程管理接口

#### 2.6.1 ~ 2.6.4 课程相关接口 🚧

**实现状态**: 🚧 **完全未实现**

**未实现原因**:
- ⚠️ 未创建 `Course` 实体类
- ⚠️ 未创建 `CourseController`
- ⚠️ 课程涉及教师、班级、科目的关联

**涉及接口**:
- `GET /api/course/list` - 课程列表
- `POST /api/course` - 添加课程
- `PUT /api/course/{id}` - 修改课程
- `DELETE /api/course/{id}` - 删除课程

---

### 2.7 排课管理接口

#### 2.7.1 ~ 2.7.3 排课相关接口 🚧

**实现状态**: 🚧 **完全未实现**

**未实现原因**:
- ⚠️ 未创建 `Schedule` 实体类
- ⚠️ 未创建 `ScheduleController`
- ⚠️ 排课涉及复杂的冲突检测逻辑

**涉及接口**:
- `GET /api/schedule/list` - 课程表查询
- `POST /api/schedule` - 添加排课
- `PUT /api/schedule/{id}` - 修改排课
- `DELETE /api/schedule/{id}` - 删除排课

**关键功能**:
- 教室冲突检测（同一时间段教室不能被占用）
- 教师冲突检测（同一时间段教师不能上两节课）
- 班级冲突检测（同一时间段班级不能有两节课）

---

## 三、业务流程模块

### 3.1 请假申请接口

#### 3.1.1 提交请假申请 ✅

**接口地址**: `POST /api/leave`

**实现状态**: ✅ 已实现

**功能描述**: 学生/家长提交请假申请

**请求参数**:
```json
{
  "studentId": 1,
  "leaveType": 1,
  "startDate": "2024-11-20",
  "endDate": "2024-11-22",
  "leaveDays": 3,
  "reason": "感冒发烧，需要在家休息",
  "proofFiles": ["http://example.com/proof1.jpg"]
}
```

**实现位置**: `LeaveController.java:23`

**已实现功能**:
- ✅ 提交请假申请
- ✅ 生成请假记录
- ⚠️ 审批流程可能未完全实现

---

#### 3.1.2 请假详情 ✅

**接口地址**: `GET /api/leave/{id}`

**实现状态**: ✅ 已实现

**实现位置**: `LeaveController.java:32`

---

#### 3.1.3 我的请假记录 ✅

**接口地址**: `GET /api/leave/my`

**实现状态**: ✅ 已实现（支持分页）

**请求参数**:
```
studentId=1&page=1&size=10
```

**实现位置**: `LeaveController.java:39`

---

#### 3.1.4 撤回请假 ✅

**接口地址**: `PUT /api/leave/{id}/cancel`

**实现状态**: ✅ 已实现

**实现位置**: `LeaveController.java:49`

---

#### 3.1.5 待审批请假列表 ✅

**接口地址**: `GET /api/leave/pending`

**实现状态**: ✅ 已实现（支持分页）

**请求参数**:
```
classId=1&page=1&size=10
```

**实现位置**: `LeaveController.java:58`

---

### 3.2 调课申请接口

#### 3.2.1 ~ 3.2.3 调课相关接口 🚧

**实现状态**: 🚧 **完全未实现**

**未实现原因**:
- ⚠️ 未创建 `CourseChange` 实体类
- ⚠️ 未创建 `CourseChangeController`
- ⚠️ 需要实现课表变更逻辑

**涉及接口**:
- `POST /api/course-change/apply` - 提交调课申请
- `GET /api/course-change/list` - 调课列表
- `GET /api/course-change/{id}` - 调课详情

---

### 3.3 换课申请接口

#### 3.3.1 ~ 3.3.3 换课相关接口 🚧

**实现状态**: 🚧 **完全未实现**

**未实现原因**:
- ⚠️ 未创建 `CourseSwap` 实体类
- ⚠️ 未创建 `CourseSwapController`
- ⚠️ 需要实现目标教师确认机制

**涉及接口**:
- `POST /api/course-swap/apply` - 提交换课申请
- `PUT /api/course-swap/{id}/confirm` - 对方确认
- `GET /api/course-swap/my` - 我的换课记录

---

### 3.4 调班申请接口

#### 3.4.1 ~ 3.4.2 调班相关接口 🚧

**实现状态**: 🚧 **完全未实现**

**未实现原因**:
- ⚠️ 未创建 `ClassTransfer` 实体类
- ⚠️ 未创建 `ClassTransferController`
- ⚠️ 需要实现多级审批流程

**涉及接口**:
- `POST /api/class-transfer/apply` - 提交调班申请
- `GET /api/class-transfer/{id}` - 调班详情

---

### 3.5 审批流程接口

#### 3.5.1 ~ 3.5.5 审批相关接口 🚧

**实现状态**: 🚧 **完全未实现**

**未实现原因**:
- ⚠️ 未创建 `Approval` 实体类
- ⚠️ 未创建 `ApprovalController`
- ⚠️ 审批流程引擎未实现

**涉及接口**:
- `GET /api/approval/pending` - 待我审批
- `GET /api/approval/{id}` - 审批详情
- `POST /api/approval/{id}/submit` - 提交审批
- `GET /api/approval/my-records` - 我的审批记录
- `GET /api/approval/my-applications` - 我的申请记录

---

## 附录

### A. 通用响应格式

所有接口统一使用以下响应格式：

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {}
}
```

**状态码说明**：
- `200` - 操作成功
- `400` - 请求参数错误
- `401` - 未授权（未登录或Token失效）
- `403` - 无权限访问
- `404` - 资源不存在
- `500` - 服务器内部错误

---

### B. 分页请求参数

所有分页接口统一使用以下参数：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| pageNum 或 page | int | 否 | 页码，默认1 |
| pageSize 或 size | int | 否 | 每页条数，默认10 |

**分页响应格式**：
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "total": 100,
    "list": []
  }
}
```

---

### C. Token使用说明

1. **获取Token**: 调用登录接口获取JWT Token
2. **使用Token**: 在请求头中添加 `Authorization: Bearer <token>`
3. **Token有效期**: 默认24小时（可在配置文件中调整）
4. **Token刷新**: 暂未实现自动刷新机制

---

### D. 数据字典

#### 用户类型 (user_type)
- `1` - 管理员
- `2` - 教师
- `3` - 学生
- `4` - 家长

#### 性别 (gender)
- `1` - 男
- `2` - 女

#### 状态 (status)
- `0` - 禁用
- `1` - 启用

#### 请假类型 (leave_type)
- `1` - 病假
- `2` - 事假
- `3` - 其他

#### 审批状态 (approval_status)
- `1` - 待审批
- `2` - 审批中
- `3` - 已通过
- `4` - 已拒绝
- `5` - 已撤回

#### 业务类型 (business_type)
- `1` - 请假申请
- `2` - 调课申请
- `3` - 换课申请
- `4` - 调班申请

---

### E. 开发优先级建议

根据业务重要性和依赖关系，建议按以下顺序实现：

**第一阶段：基础功能**（优先级：高）
1. ✅ 用户登录/登出
2. 🚧 用户注册
3. 🚧 用户信息查询
4. 🚧 角色管理（增删改查）
5. 🚧 菜单管理（增删改查、树形结构）

**第二阶段：教务核心**（优先级：高）
1. ✅ 年级管理（查询已实现，增删改待实现）
2. 🚧 科目管理
3. ✅ 班级管理（基本CRUD已实现）
4. ✅ 教师管理（基本CRUD已实现）
5. ✅ 学生管理（基本CRUD已实现）

**第三阶段：课程排课**（优先级：中）
1. 🚧 课程管理
2. 🚧 排课管理（含冲突检测）
3. 🚧 课程表查询（教师课表、班级课表）

**第四阶段：业务流程**（优先级：中）
1. 🚧 审批流程引擎
2. ✅ 请假申请（基本功能已实现）
3. 🚧 调课申请
4. 🚧 换课申请
5. 🚧 调班申请

**第五阶段：扩展功能**（优先级：低）
1. 🚧 成绩管理
2. 🚧 考勤管理
3. 🚧 通知公告
4. 🚧 家校互动
5. 🚧 数据统计报表

---

### F. 技术实现建议

#### 1. 实体类创建
- 所有实体类继承 `BaseEntity`（包含通用字段：id, createdAt, updatedAt, isDeleted）
- 使用 MyBatis-Plus 注解（@TableName, @TableId, @TableField）
- 使用 Lombok 注解（@Data, @Accessors(chain = true)）

#### 2. Controller层规范
- 统一使用 `@RestController` 注解
- 统一请求路径前缀 `/api/{模块名}`
- 统一返回 `R` 对象（ResultCode枚举）
- 添加参数校验（@Valid, @NotNull, @NotBlank等）
- 添加权限注解（待实现）

#### 3. Service层规范
- 继承 `IService<T>`（MyBatis-Plus）
- 实现类继承 `ServiceImpl<M, T>`
- 复杂业务逻辑添加事务注解 `@Transactional`

#### 4. 缓存策略
- 使用Redis缓存菜单树
- 使用Redis缓存角色权限
- 使用Redis存储Token黑名单
- 使用Redis缓存基础数据（年级、科目等）

#### 5. 审批流程引擎设计
- 使用责任链模式实现多级审批
- 使用状态机模式管理审批状态流转
- 支持动态配置审批流程
- 记录每个审批节点的审批人和审批意见

---

### G. 当前存在的问题

#### 🐛 已知BUG

1. **TeacherController.java:14** - `GET /api/teacher/{id}` 接口实现错误
   - 问题：方法体调用的是 `teacherList()` 而不是根据ID查询
   - 影响：无法查询单个教师详情
   - 修复建议：修改为 `getTeacherById(id)` 方法调用

2. **GradeController.java:18** - `GET /api/grade/**` 使用了不规范的通配符
   - 问题：路径使用了 `**` 通配符
   - 影响：路径不规范，可能导致意外的路由匹配
   - 修复建议：改为 `/api/grade/list`

#### ⚠️ 功能缺失

1. **分页功能缺失**
   - 教师列表、学生列表、班级列表、年级列表都未实现分页
   - 数据量大时可能导致性能问题
   - 建议：统一实现分页功能

2. **唯一性验证缺失**
   - 教师编号、学生学号、班级编号等未做唯一性验证
   - 可能导致重复数据
   - 建议：在Service层添加唯一性验证

3. **软删除未实现**
   - 所有删除操作都是物理删除
   - 无法恢复误删除的数据
   - 建议：改为软删除（更新 is_deleted 字段）

4. **关联数据验证缺失**
   - 删除教师时未检查是否担任班主任
   - 删除班级时未检查是否有学生
   - 可能导致数据不一致
   - 建议：添加关联数据验证


- 项目源码：`/src/main/java/com/example/primaryschoolmanagement/`


**文档维护**: 请在每次实现或修改接口后及时更新此文档

**最后更新时间**: 2025-11-18
**版本**: v2.0
