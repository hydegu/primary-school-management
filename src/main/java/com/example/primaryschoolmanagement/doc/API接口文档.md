# 小学教务管理系统 - API接口文档

> **文档版本**: v1.0
> **最后更新**: 2025-11-18
> **项目状态**: 开发中 🚧

---

## 📌 文档说明

本文档整合了小学教务管理系统的所有API接口设计，并标注了当前的实现状态。

**图例说明**：
- ✅ **已实现** - 接口已完成开发和测试
- 🚧 **未实现** - 接口设计已确定，但尚未开发
- ⚠️ **部分实现** - 接口已开发但功能不完整

**当前实现进度**：
- 系统管理模块：**10%** (2/20 接口已实现)
- 教务核心模块：**0%** (0/35 接口已实现)
- 业务流程模块：**0%** (0/25 接口已实现)

---

## 📋 目录

- [一、系统管理模块](#一系统管理模块)
  - [1.1 用户认证接口](#11-用户认证接口)
  - [1.2 角色管理接口](#12-角色管理接口)
  - [1.3 菜单管理接口](#13-菜单管理接口)
- [二、教务核心模块](#二教务核心模块)
  - [2.1 教师管理接口](#21-教师管理接口)
  - [2.2 学生管理接口](#22-学生管理接口)
  - [2.3 班级管理接口](#23-班级管理接口)
  - [2.4 年级管理接口](#24-年级管理接口)
  - [2.5 科目管理接口](#25-科目管理接口)
  - [2.6 课程管理接口](#26-课程管理接口)
  - [2.7 排课管理接口](#27-排课管理接口)
- [三、业务流程模块](#三业务流程模块)
  - [3.1 请假申请接口](#31-请假申请接口)
  - [3.2 调课申请接口](#32-调课申请接口)
  - [3.3 换课申请接口](#33-换课申请接口)
  - [3.4 调班申请接口](#34-调班申请接口)
  - [3.5 审批流程接口](#35-审批流程接口)

---

## 一、系统管理模块

### 1.1 用户认证接口

#### 1.1.1 用户登录 ✅

**接口地址**: `POST /api/user/login`

**实现状态**: ✅ 已实现

**功能描述**: 用户登录验证，成功后返回JWT Token

**请求参数**:
```json
{
  "identifier": "admin",      // 用户名或手机号或邮箱
  "password": "admin123"      // 密码
}
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."  // JWT Token
}
```

**实现位置**: `UserController.java:49`

---

#### 1.1.2 用户登出 ✅

**接口地址**: `POST /api/user/logout`

**实现状态**: ✅ 已实现

**功能描述**: 用户登出，将Token加入黑名单

**请求头**:
```
Authorization: Bearer <token>
```

**响应示例**:
```json
{
  "code": 200,
  "msg": "登出成功"
}
```

**实现位置**: `UserController.java:80`

---

#### 1.1.3 用户注册 🚧

**接口地址**: `POST /api/user/register`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ Service层有 `regUser()` 方法，但Controller层未暴露接口
- ⚠️ 需要添加注册参数验证（用户名唯一性、密码强度等）
- ⚠️ 需要确定注册流程（是否需要邮箱验证、手机验证码等）

**功能描述**: 新用户注册

**预期请求参数**:
```json
{
  "userName": "student001",
  "password": "Pass@123",
  "realName": "张三",
  "userType": 3,              // 1-管理员 2-教师 3-学生 4-家长
  "phone": "13800138000",
  "email": "student001@example.com"
}
```

**待实现功能**:
1. [ ] Controller接口开发
2. [ ] 用户名/手机号/邮箱唯一性验证
3. [ ] 密码强度验证
4. [ ] 发送验证码功能（可选）
5. [ ] 自动分配默认角色

---

#### 1.1.4 修改密码 🚧

**接口地址**: `PUT /api/user/password`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ Service层有 `updatePassword()` 方法，但未暴露接口
- ⚠️ 需要实现旧密码验证逻辑
- ⚠️ 需要添加密码修改日志记录

**功能描述**: 用户修改自己的密码

**预期请求参数**:
```json
{
  "oldPassword": "OldPass@123",
  "newPassword": "NewPass@456",
  "confirmPassword": "NewPass@456"
}
```

**待实现功能**:
1. [ ] Controller接口开发
2. [ ] 旧密码验证
3. [ ] 新密码强度验证
4. [ ] 密码修改日志记录
5. [ ] 修改后自动登出（需重新登录）

---

#### 1.1.5 获取当前用户信息 🚧

**接口地址**: `GET /api/user/profile`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 需要从Token中解析用户ID
- ⚠️ 需要关联查询角色和权限信息

**功能描述**: 获取当前登录用户的详细信息

**预期响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "userName": "admin",
    "realName": "系统管理员",
    "userType": 1,
    "avatar": "http://example.com/avatar.jpg",
    "phone": "13800138000",
    "email": "admin@example.com",
    "roles": ["超级管理员"],
    "permissions": ["*:*:*"]
  }
}
```

**待实现功能**:
1. [ ] Controller接口开发
2. [ ] 从JWT Token解析用户ID
3. [ ] 关联查询用户角色
4. [ ] 关联查询用户权限

---

### 1.2 角色管理接口

#### 1.2.1 角色列表查询 🚧

**接口地址**: `GET /api/role/list`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 RoleController
- ⚠️ 未创建 RoleService 接口
- ⚠️ 需要实现分页查询功能

**功能描述**: 查询角色列表，支持分页和条件筛选

**预期请求参数**:
```
pageNum=1&pageSize=10&roleName=教师
```

**预期响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "total": 5,
    "list": [
      {
        "id": 2,
        "roleName": "教师",
        "roleCode": "teacher",
        "roleDesc": "普通教师角色",
        "status": 1,
        "createdAt": "2024-01-01 10:00:00"
      }
    ]
  }
}
```

**待实现功能**:
1. [ ] 创建 RoleController
2. [ ] 创建 RoleService 接口和实现类
3. [ ] 创建 RoleMapper
4. [ ] 实现分页查询
5. [ ] 实现条件筛选（角色名称、状态等）

---

#### 1.2.2 添加角色 🚧

**接口地址**: `POST /api/role`

**实现状态**: 🚧 未实现

**功能描述**: 添加新角色

**待实现功能**:
1. [ ] 角色编码唯一性验证
2. [ ] 参数验证
3. [ ] 权限控制（仅管理员可操作）

---

#### 1.2.3 修改角色 🚧

**接口地址**: `PUT /api/role/{id}`

**实现状态**: 🚧 未实现

---

#### 1.2.4 删除角色 🚧

**接口地址**: `DELETE /api/role/{id}`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 需要检查角色是否被用户使用
- ⚠️ 不能删除系统内置角色（超级管理员等）

---

#### 1.2.5 分配权限 🚧

**接口地址**: `POST /api/role/{id}/menu`

**实现状态**: 🚧 未实现

**功能描述**: 为角色分配菜单权限

**预期请求参数**:
```json
{
  "menuIds": [1, 2, 3, 5, 8]
}
```

**待实现功能**:
1. [ ] 批量插入/更新 sys_role_menu 表
2. [ ] 清除Redis中的权限缓存
3. [ ] 记录权限变更日志

---

### 1.3 菜单管理接口

#### 1.3.1 菜单树查询 🚧

**接口地址**: `GET /api/menu/tree`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 MenuController
- ⚠️ 需要实现递归树形结构

**功能描述**: 查询菜单树（用于前端动态菜单渲染）

**预期响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "menuName": "系统管理",
      "menuType": 1,
      "icon": "el-icon-setting",
      "children": [
        {
          "id": 2,
          "menuName": "用户管理",
          "menuType": 2,
          "routePath": "/system/user",
          "children": [
            {
              "id": 3,
              "menuName": "新增用户",
              "menuType": 3,
              "permission": "system:user:add"
            }
          ]
        }
      ]
    }
  ]
}
```

**待实现功能**:
1. [ ] 创建 MenuController
2. [ ] 创建 MenuService 和 Mapper
3. [ ] 实现递归查询树形结构
4. [ ] 根据用户角色过滤菜单

---

#### 1.3.2 添加菜单 🚧

**接口地址**: `POST /api/menu`

**实现状态**: 🚧 未实现

---

#### 1.3.3 修改菜单 🚧

**接口地址**: `PUT /api/menu/{id}`

**实现状态**: 🚧 未实现

---

#### 1.3.4 删除菜单 🚧

**接口地址**: `DELETE /api/menu/{id}`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 需要检查是否有子菜单
- ⚠️ 需要检查是否被角色使用

---

## 二、教务核心模块

### 2.1 教师管理接口

#### 2.1.1 教师列表查询 🚧

**接口地址**: `GET /api/teacher/list`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 `edu_teacher` 表对应的 Entity
- ⚠️ 未创建 TeacherController
- ⚠️ 未创建 TeacherService

**功能描述**: 查询教师列表，支持分页和条件筛选

**预期请求参数**:
```
pageNum=1&pageSize=10&teacherName=张&status=1
```

**预期响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "total": 25,
    "list": [
      {
        "id": 1,
        "teacherNo": "T001",
        "teacherName": "张老师",
        "gender": 1,
        "phone": "13800138001",
        "title": "语文教师",
        "hireDate": "2020-09-01",
        "status": 1
      }
    ]
  }
}
```

**待实现功能**:
1. [ ] 创建 Teacher 实体类
2. [ ] 创建 TeacherController
3. [ ] 创建 TeacherService 和 Mapper
4. [ ] 实现分页查询
5. [ ] 实现条件筛选（姓名、职称、状态等）

---

#### 2.1.2 添加教师 🚧

**接口地址**: `POST /api/teacher`

**实现状态**: 🚧 未实现

**功能描述**: 添加新教师信息

**预期请求参数**:
```json
{
  "teacherNo": "T100",
  "teacherName": "李老师",
  "gender": 2,
  "birthDate": "1985-03-15",
  "idCard": "110101198503150011",
  "phone": "13900139000",
  "email": "teacher100@school.com",
  "title": "数学教师",
  "hireDate": "2024-09-01"
}
```

**待实现功能**:
1. [ ] 教师编号唯一性验证
2. [ ] 身份证号验证
3. [ ] 自动创建对应的 sys_user 账号
4. [ ] 自动分配教师角色
5. [ ] 发送账号通知（邮件/短信）

---

#### 2.1.3 修改教师 🚧

**接口地址**: `PUT /api/teacher/{id}`

**实现状态**: 🚧 未实现

---

#### 2.1.4 删除教师 🚧

**接口地址**: `DELETE /api/teacher/{id}`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 需要检查教师是否担任班主任
- ⚠️ 需要检查教师是否有任课记录
- ⚠️ 建议使用软删除

---

#### 2.1.5 教师详情 🚧

**接口地址**: `GET /api/teacher/{id}`

**实现状态**: 🚧 未实现

---

#### 2.1.6 教师课程表 🚧

**接口地址**: `GET /api/teacher/{id}/schedule`

**实现状态**: 🚧 未实现

**功能描述**: 查询教师的课程表

**预期响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "teacherName": "张老师",
    "semester": "2024-2025-1",
    "schedule": [
      {
        "weekDay": 1,
        "weekDayName": "周一",
        "periods": [
          {
            "period": 1,
            "className": "一年一班",
            "subjectName": "语文",
            "classroom": "101",
            "startTime": "08:00",
            "endTime": "08:40"
          }
        ]
      }
    ]
  }
}
```

**待实现功能**:
1. [ ] 关联查询 edu_schedule、edu_course、edu_subject
2. [ ] 按周次、节次排序
3. [ ] 支持学期筛选

---

### 2.2 学生管理接口

#### 2.2.1 学生列表查询 🚧

**接口地址**: `GET /api/student/list`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 Student 实体类
- ⚠️ 未创建 StudentController
- ⚠️ 未创建 StudentService

**功能描述**: 查询学生列表，支持分页和条件筛选

**待实现功能**:
1. [ ] 创建 Student 实体类
2. [ ] 创建 StudentController
3. [ ] 创建 StudentService 和 Mapper
4. [ ] 实现分页查询
5. [ ] 实现条件筛选（姓名、班级、年级、状态等）

---

#### 2.2.2 添加学生 🚧

**接口地址**: `POST /api/student`

**实现状态**: 🚧 未实现

**功能描述**: 添加新学生

**预期请求参数**:
```json
{
  "studentNo": "S2024001",
  "studentName": "小明",
  "gender": 1,
  "birthDate": "2016-05-20",
  "idCard": "110101201605200011",
  "gradeId": 1,
  "classId": 1,
  "parentPhone": "13800138000"
}
```

**待实现功能**:
1. [ ] 学号唯一性验证
2. [ ] 身份证号验证
3. [ ] 自动创建对应的 sys_user 账号
4. [ ] 自动分配学生角色
5. [ ] 更新班级学生人数
6. [ ] 关联家长信息（如果提供）

---

#### 2.2.3 修改学生 🚧

**接口地址**: `PUT /api/student/{id}`

**实现状态**: 🚧 未实现

---

#### 2.2.4 删除学生 🚧

**接口地址**: `DELETE /api/student/{id}`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 需要更新班级学生人数
- ⚠️ 建议使用软删除
- ⚠️ 需要记录操作日志

---

#### 2.2.5 学生详情 🚧

**接口地址**: `GET /api/student/{id}`

**实现状态**: 🚧 未实现

---

#### 2.2.6 学生家长关联 🚧

**接口地址**: `POST /api/student/{id}/parent`

**实现状态**: 🚧 未实现

**功能描述**: 关联学生和家长

**预期请求参数**:
```json
{
  "parentId": 10,
  "relation": "父亲"
}
```

**待实现功能**:
1. [ ] 创建 Parent 实体类
2. [ ] 插入 edu_student_parent 关联表
3. [ ] 支持一个学生关联多个家长

---

### 2.3 班级管理接口

#### 2.3.1 班级列表查询 🚧

**接口地址**: `GET /api/class/list`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 Class 实体类（注意：Class是Java关键字，建议命名为 SchoolClass）
- ⚠️ 未创建 ClassController

**待实现功能**:
1. [ ] 创建 SchoolClass 实体类
2. [ ] 创建 ClassController
3. [ ] 关联查询年级、班主任信息
4. [ ] 显示当前学生人数

---

#### 2.3.2 添加班级 🚧

**接口地址**: `POST /api/class`

**实现状态**: 🚧 未实现

**功能描述**: 添加新班级

**预期请求参数**:
```json
{
  "classNo": "C2024-01",
  "className": "一年一班",
  "gradeId": 1,
  "headTeacherId": 5,
  "classroom": "101",
  "maxStudents": 50,
  "schoolYear": "2024-2025"
}
```

**待实现功能**:
1. [ ] 班级编号唯一性验证
2. [ ] 验证班主任是否已担任其他班级班主任
3. [ ] 验证教室是否被占用

---

#### 2.3.3 班级课程表 🚧

**接口地址**: `GET /api/class/{id}/schedule`

**实现状态**: 🚧 未实现

**功能描述**: 查询班级课程表

---

#### 2.3.4 班级学生列表 🚧

**接口地址**: `GET /api/class/{id}/students`

**实现状态**: 🚧 未实现

---

### 2.4 年级管理接口

#### 2.4.1 年级列表查询 🚧

**接口地址**: `GET /api/grade/list`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 Grade 实体类
- ⚠️ 未创建 GradeController

---

#### 2.4.2 添加年级 🚧

**接口地址**: `POST /api/grade`

**实现状态**: 🚧 未实现

---

### 2.5 科目管理接口

#### 2.5.1 科目列表查询 🚧

**接口地址**: `GET /api/subject/list`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 Subject 实体类
- ⚠️ 未创建 SubjectController

---

#### 2.5.2 添加科目 🚧

**接口地址**: `POST /api/subject`

**实现状态**: 🚧 未实现

---

### 2.6 课程管理接口

#### 2.6.1 课程列表查询 🚧

**接口地址**: `GET /api/course/list`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 Course 实体类
- ⚠️ 未创建 CourseController
- ⚠️ 课程涉及教师、班级、科目的关联

---

#### 2.6.2 添加课程 🚧

**接口地址**: `POST /api/course`

**实现状态**: 🚧 未实现

**功能描述**: 为某个班级在某个学期添加课程

**预期请求参数**:
```json
{
  "courseName": "一年级语文",
  "subjectId": 1,
  "classId": 1,
  "teacherId": 5,
  "semester": "2024-2025-1",
  "weeklyHours": 8,
  "totalHours": 160
}
```

**待实现功能**:
1. [ ] 验证教师、班级、科目是否存在
2. [ ] 验证同一个班级不能重复添加相同科目
3. [ ] 记录创建日志

---

### 2.7 排课管理接口

#### 2.7.1 课程表查询 🚧

**接口地址**: `GET /api/schedule/list`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 Schedule 实体类
- ⚠️ 未创建 ScheduleController
- ⚠️ 排课涉及复杂的冲突检测逻辑

---

#### 2.7.2 添加排课 🚧

**接口地址**: `POST /api/schedule`

**实现状态**: 🚧 未实现

**功能描述**: 为课程安排具体的上课时间

**预期请求参数**:
```json
{
  "courseId": 1,
  "weekDay": 1,
  "period": 1,
  "classroom": "101",
  "startTime": "08:00",
  "endTime": "08:40"
}
```

**待实现功能**:
1. [ ] 教室冲突检测（同一时间段教室不能被占用）
2. [ ] 教师冲突检测（同一时间段教师不能上两节课）
3. [ ] 班级冲突检测（同一时间段班级不能有两节课）
4. [ ] 批量排课功能

---

## 三、业务流程模块

### 3.1 请假申请接口

#### 3.1.1 提交请假申请 🚧

**接口地址**: `POST /api/leave/apply`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 Leave 实体类
- ⚠️ 未创建 LeaveController
- ⚠️ 需要实现审批流程引擎

**功能描述**: 学生/家长提交请假申请

**预期请求参数**:
```json
{
  "studentId": 1,
  "leaveType": 1,
  "startDate": "2024-11-20",
  "endDate": "2024-11-22",
  "leaveDays": 3,
  "reason": "感冒发烧，需要在家休息",
  "proofFiles": ["http://example.com/proof1.jpg"]
}
```

**预期响应示例**:
```json
{
  "code": 200,
  "msg": "请假申请提交成功",
  "data": {
    "leaveNo": "L20241118001",
    "approvalStatus": 1,
    "approvalStatusName": "待审批"
  }
}
```

**待实现功能**:
1. [ ] 创建 Leave 实体类
2. [ ] 创建 LeaveController 和 LeaveService
3. [ ] 生成请假单号
4. [ ] 创建审批流程
5. [ ] 通知班主任审批
6. [ ] 文件上传功能（证明材料）

---

#### 3.1.2 请假列表查询 🚧

**接口地址**: `GET /api/leave/list`

**实现状态**: 🚧 未实现

**功能描述**: 查询请假记录列表

---

#### 3.1.3 请假详情 🚧

**接口地址**: `GET /api/leave/{id}`

**实现状态**: 🚧 未实现

---

#### 3.1.4 撤回请假 🚧

**接口地址**: `PUT /api/leave/{id}/withdraw`

**实现状态**: 🚧 未实现

**功能描述**: 撤回待审批的请假申请

---

### 3.2 调课申请接口

#### 3.2.1 提交调课申请 🚧

**接口地址**: `POST /api/course-change/apply`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 CourseChange 实体类
- ⚠️ 未创建 CourseChangeController
- ⚠️ 需要实现课表变更逻辑

**功能描述**: 教师提交调课申请

**预期请求参数**:
```json
{
  "originalScheduleId": 10,
  "originalDate": "2024-11-20",
  "originalPeriod": 1,
  "newDate": "2024-11-21",
  "newPeriod": 2,
  "newClassroom": "102",
  "reason": "临时有事，需要调整上课时间"
}
```

**待实现功能**:
1. [ ] 创建 CourseChange 实体类
2. [ ] 生成调课单号
3. [ ] 创建审批流程
4. [ ] 新时间段冲突检测
5. [ ] 审批通过后自动更新课程表

---

#### 3.2.2 调课列表查询 🚧

**接口地址**: `GET /api/course-change/list`

**实现状态**: 🚧 未实现

---

### 3.3 换课申请接口

#### 3.3.1 提交换课申请 🚧

**接口地址**: `POST /api/course-swap/apply`

**实现状态**: 🚧 未实现

**功能描述**: 教师与其他教师交换课程

**预期请求参数**:
```json
{
  "applyScheduleId": 10,
  "targetTeacherId": 8,
  "targetScheduleId": 15,
  "reason": "与其他教师协商换课"
}
```

**待实现功能**:
1. [ ] 创建 CourseSwap 实体类
2. [ ] 目标教师确认机制
3. [ ] 双方课程互换逻辑
4. [ ] 审批流程

---

### 3.4 调班申请接口

#### 3.4.1 提交调班申请 🚧

**接口地址**: `POST /api/class-transfer/apply`

**实现状态**: 🚧 未实现

**功能描述**: 学生申请转班

**预期请求参数**:
```json
{
  "studentId": 1,
  "targetClassId": 5,
  "reason": "家长要求转班",
  "effectiveDate": "2024-12-01"
}
```

**待实现功能**:
1. [ ] 创建 ClassTransfer 实体类
2. [ ] 原班主任审批
3. [ ] 新班主任审批
4. [ ] 教务主任审批（多级审批）
5. [ ] 审批通过后更新学生班级
6. [ ] 更新班级学生人数

---

### 3.5 审批流程接口

#### 3.5.1 我的待审批列表 🚧

**接口地址**: `GET /api/approval/pending`

**实现状态**: 🚧 未实现

**未实现原因**:
- ⚠️ 未创建 Approval 实体类
- ⚠️ 未创建 ApprovalController
- ⚠️ 审批流程引擎未实现

**功能描述**: 查询当前用户的待审批事项

**预期响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "total": 3,
    "list": [
      {
        "approvalNo": "AP20241118001",
        "businessType": 1,
        "businessTypeName": "请假申请",
        "applyUserName": "小明",
        "reason": "感冒发烧",
        "applyTime": "2024-11-18 10:00:00"
      }
    ]
  }
}
```

**待实现功能**:
1. [ ] 创建 Approval 实体类
2. [ ] 创建 ApprovalController 和 ApprovalService
3. [ ] 查询当前用户待审批的所有业务
4. [ ] 支持按业务类型筛选

---

#### 3.5.2 审批详情 🚧

**接口地址**: `GET /api/approval/{id}`

**实现状态**: 🚧 未实现

**功能描述**: 查询审批详情及审批流程

**预期响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "approvalNo": "AP20241118001",
    "businessType": 1,
    "businessTypeName": "请假申请",
    "applyUserName": "小明",
    "reason": "感冒发烧",
    "applyTime": "2024-11-18 10:00:00",
    "approvalStatus": 2,
    "approvalStatusName": "审批中",
    "nodes": [
      {
        "nodeLevel": 1,
        "approverName": "张老师",
        "approvalStatus": 2,
        "approvalStatusName": "已通过",
        "approvalTime": "2024-11-18 11:00:00",
        "approvalOpinion": "同意请假"
      },
      {
        "nodeLevel": 2,
        "approverName": "教务主任",
        "approvalStatus": 1,
        "approvalStatusName": "待审批",
        "approvalTime": null
      }
    ]
  }
}
```

---

#### 3.5.3 提交审批 🚧

**接口地址**: `POST /api/approval/{id}/submit`

**实现状态**: 🚧 未实现

**功能描述**: 审批人提交审批意见

**预期请求参数**:
```json
{
  "approvalStatus": 2,    // 2-通过 3-拒绝
  "approvalOpinion": "同意请假"
}
```

**待实现功能**:
1. [ ] 更新当前审批节点状态
2. [ ] 判断是否为最后一个审批节点
3. [ ] 如果是最后节点且通过，更新业务表状态
4. [ ] 如果不是最后节点，通知下一级审批人
5. [ ] 发送审批结果通知给申请人

---

#### 3.5.4 我的审批记录 🚧

**接口地址**: `GET /api/approval/my-records`

**实现状态**: 🚧 未实现

**功能描述**: 查询我审批过的记录

---

#### 3.5.5 我的申请记录 🚧

**接口地址**: `GET /api/approval/my-applications`

**实现状态**: 🚧 未实现

**功能描述**: 查询我提交的申请记录

---

## 附录

### A. 通用响应格式

所有接口统一使用以下响应格式：

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {}
}
```

**状态码说明**：
- `200` - 操作成功
- `400` - 请求参数错误
- `401` - 未授权（未登录或Token失效）
- `403` - 无权限访问
- `404` - 资源不存在
- `500` - 服务器内部错误

---

### B. 分页请求参数

所有分页接口统一使用以下参数：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| pageNum | int | 否 | 页码，默认1 |
| pageSize | int | 否 | 每页条数，默认10 |

**分页响应格式**：
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "total": 100,
    "list": []
  }
}
```

---

### C. Token使用说明

1. **获取Token**: 调用登录接口获取JWT Token
2. **使用Token**: 在请求头中添加 `Authorization: Bearer <token>`
3. **Token有效期**: 默认24小时（可在配置文件中调整）
4. **Token刷新**: 暂未实现自动刷新机制

---

### D. 数据字典

#### 用户类型 (user_type)
- `1` - 管理员
- `2` - 教师
- `3` - 学生
- `4` - 家长

#### 性别 (gender)
- `1` - 男
- `2` - 女

#### 状态 (status)
- `0` - 禁用
- `1` - 启用

#### 请假类型 (leave_type)
- `1` - 病假
- `2` - 事假
- `3` - 其他

#### 审批状态 (approval_status)
- `1` - 待审批
- `2` - 审批中
- `3` - 已通过
- `4` - 已拒绝
- `5` - 已撤回

#### 业务类型 (business_type)
- `1` - 请假申请
- `2` - 调课申请
- `3` - 换课申请
- `4` - 调班申请

---

### E. 开发优先级建议

根据业务重要性和依赖关系，建议按以下顺序实现：

**第一阶段：基础功能**（优先级：高）
1. ✅ 用户登录/登出
2. 🚧 用户注册
3. 🚧 用户信息查询
4. 🚧 角色管理（增删改查）
5. 🚧 菜单管理（增删改查、树形结构）

**第二阶段：教务核心**（优先级：高）
1. 🚧 年级管理
2. 🚧 科目管理
3. 🚧 班级管理
4. 🚧 教师管理
5. 🚧 学生管理

**第三阶段：课程排课**（优先级：中）
1. 🚧 课程管理
2. 🚧 排课管理（含冲突检测）
3. 🚧 课程表查询（教师课表、班级课表）

**第四阶段：业务流程**（优先级：中）
1. 🚧 审批流程引擎
2. 🚧 请假申请
3. 🚧 调课申请
4. 🚧 换课申请
5. 🚧 调班申请

**第五阶段：扩展功能**（优先级：低）
1. 🚧 成绩管理
2. 🚧 考勤管理
3. 🚧 通知公告
4. 🚧 家校互动
5. 🚧 数据统计报表

---

### F. 技术实现建议

#### 1. 实体类创建
- 所有实体类继承 `BaseEntity`（包含通用字段：id, createdAt, updatedAt, isDeleted）
- 使用 MyBatis-Plus 注解（@TableName, @TableId, @TableField）
- 使用 Lombok 注解（@Data, @Accessors(chain = true)）

#### 2. Controller层规范
- 统一使用 `@RestController` 注解
- 统一请求路径前缀 `/api/{模块名}`
- 统一返回 `R` 对象（ResultCode枚举）
- 添加参数校验（@Valid, @NotNull, @NotBlank等）
- 添加权限注解（待实现）

#### 3. Service层规范
- 继承 `IService<T>`（MyBatis-Plus）
- 实现类继承 `ServiceImpl<M, T>`
- 复杂业务逻辑添加事务注解 `@Transactional`

#### 4. 缓存策略
- 使用Redis缓存菜单树
- 使用Redis缓存角色权限
- 使用Redis存储Token黑名单
- 使用Redis缓存基础数据（年级、科目等）

#### 5. 审批流程引擎设计
- 使用责任链模式实现多级审批
- 使用状态机模式管理审批状态流转
- 支持动态配置审批流程
- 记录每个审批节点的审批人和审批意见

---

### G. 相关文档

- [数据库设计文档](./README.md)
- [ER关系图](./ER图.md)
- 项目源码：`/src/main/java/com/example/primaryschoolmanagement/`

---

**文档维护**: 请在每次实现接口后及时更新此文档，将 🚧 标记改为 ✅，并更新实现位置

**最后更新时间**: 2025-11-18
